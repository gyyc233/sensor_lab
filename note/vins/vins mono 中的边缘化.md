- [vins mono 中的边缘化](#vins-mono-中的边缘化)
  - [边缘化的作用](#边缘化的作用)
  - [边缘化步骤](#边缘化步骤)
  - [边缘化的关键问题与解决方案](#边缘化的关键问题与解决方案)
  - [VINS-Mono 中的边缘化策略](#vins-mono-中的边缘化策略)
  - [边缘化影响](#边缘化影响)

# vins mono 中的边缘化

在 VINS-Mono 中，边缘化（Marginalization） 是一项关键技术，用于在滑动窗口优化中管理计算复杂度，同时保留历史信息的约束，避免状态估计的维度无限增长

## 边缘化的作用

VINS-Mono 采用 滑动窗口优化（Sliding Window Optimization），窗口内保留最近的若干关键帧及其状态（位姿、速度、IMU 零偏等）。当新帧加入时，旧帧需要被移除，但直接丢弃会导致信息丢失。边缘化的核心作用：

- 保留被移除状态的约束信息，防止窗口外的观测被完全忽略。
- 维持稀疏性，避免信息矩阵（Hessian 矩阵）因长期关联变得稠密。
- 控制计算量，限制优化问题的规模。

## 边缘化步骤

1. 选择边缘化的帧

VINS-Mono 在滑动窗口中最旧的一帧（或非关键帧）会被边缘化，但需满足

- 不能边缘化 所有与最新帧共视的帧（否则会破坏观测约束）
- 通常保留窗口内最新的 5-10 个关键帧

2. 构建待边缘化的因子

将被移除帧相关的所有约束（IMU 预积分、视觉重投影）转换为 先验信息

- IMU 因子：边缘化旧帧的 IMU 预积分约束
- 视觉因子：边缘化旧帧观测到的地图点对其他帧的约束

3. 舒尔补（Schur Complement）操作

![](./img/vins%20mono%20中的边缘化/vins_marg_1.png)

4. 生成先验因子

![](./img/vins%20mono%20中的边缘化/vins_marg_2.png)

## 边缘化的关键问题与解决方案

1. 线性化点不一致性（Linearization Point Drift）

边缘化依赖线性化点，但后续优化会更新状态，导致新旧线性化点不一致，引入误差

- First Estimate Jacobians (FEJ)：固定边缘化时的线性化点，后续优化中不再更新雅可比矩阵（VINS-Mono 采用此方法）
- 迭代边缘化：在最新估计点重新线性化（计算代价较高，如 DSO 使用）

2. 信息矩阵的稠密化

舒尔补会引入 填充（Fill-in），使信息矩阵变得稠密，增加求解耗时

- 限制边缘化的频率和范围（如仅边缘化最旧帧）
- 使用稀疏求解器（如 VINS-Mono 依赖的 Ceres Solver 或 Eigen）

3. 零空间（Null Space）的影响

边缘化可能破坏系统的可观测性（如全局位姿自由度）

- 在优化中添加 伪观测（Pseudo Observation） 约束全局自由度（如固定第一帧位姿）

## VINS-Mono 中的边缘化策略

1. 边缘化触发条件

- 新关键帧加入：当滑动窗口已满（默认 10 帧），最旧的非关键帧被边缘化
- IMU 初始化完成：初始化后，旧帧的 IMU 约束被边缘化，保留视觉约束

2. 边缘化对象

- 状态变量：被移除帧的位姿 p v q imu零偏
- 地图点: 仅边缘化与旧帧关联的特征点观测，保留仍在窗口内的观测

## 边缘化影响

- 减少优化变量数量，提升实时性
- 保留历史信息，提高轨迹一致性（尤其在闭环前）
- 错误的边缘化可能导致 尺度漂移（Scale Drift）或 位姿跳变
- 先验约束过强可能抑制新观测的作用

若边缘化导致问题（如轨迹断裂或尺度异常）：

- 检查边缘化的帧选择：避免边缘化所有共视帧。
- 监控先验权重：过强的先验可能导致优化僵化。
- 验证 IMU 零偏估计：错误的零偏会传递到边缘化先验
