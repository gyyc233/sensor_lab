
# 相机标定

## monocular camera calibration

1. 已知棋盘格或者圆点标定板尺寸与间隔
2. 检测角点坐标与它的亚像素坐标
3. 调用opencv接口进行相机标定，得到相机内参，每张图像对应相机外参和畸变参数[p1,p2,k1,k2,k3]
4. 计算角点的重投影误差

使用opencv提供的left图像(去掉9和11两个角点质量较差的图)做单目相机标定，test结果

```bash
cameraMatrix:
[533.5348142327384, 0, 342.3563015304351;
 0, 533.6389010594692, 232.1399085605938;
 0, 0, 1]
distCoeffs:
[-0.2891799345322323, 0.06357801458229355, 0.001321438120696153, 
  3.667571219866039e-05, 0.1387201946705828]
```
网络结果

```bash
[[534.07030357   0.         341.53371884]
 [  0.         534.11757431 232.94773329]
 [  0.           0.           1.        ]]
[[-2.93007785e-01  1.07836472e-01  1.31038070e-03 -3.28749062e-05
   4.35604038e-02]]
```
右相机结果

```bash
cameraMatrix:
[534.823121049829, 0, 328.2817010959062;
 0, 534.6891909161666, 249.2441589958196;
 0, 0, 1]
distCoeffs:
[-0.3087679693812314, 0.248579112683175, -0.0002140218914210029, 0.0008942810727267126, -0.2582854067659677]
```

## Stereo calibration

面试被被问到双目相机标定，以前只是用对极几何和三角化的来理解双目，在极线矫正，计算视差，生成点云方面了解的不多，以致于回答得支支吾吾，感觉寄的太可惜了，回来重新整理一下吧

其实以前也做过双目相关的工作，单纯用双目相机重建工件点云，但是存在反光导致点云缺失问题，还有就是双目结构光（格雷码）重建物体，面对的主要问题还是抗反光，加了偏振光滤光片，效果还是有限，纯视觉或者vio本身橹棒性还是不够强，没有观测进行修正，时间长了感觉都会飘，废话少说，开始吧

1. 加载左视角，右视角相机图像
2. 检测图像中标定板角点并计算其亚像素精度
3. 根据标定板尺寸生成，标定板角点的三维位置(z=0)
4. 左右相机各自作相机标定
5. 根据相机内参畸变对左右相机进行极线矫正（极线对齐），计算极线
6. 计算角点和极线的点积，作为误差
7. 使用`BOUGUET'S METHOD`进行立体矫正，将双目立体标定参数保存
   1. stereoRectify函数，输出两个相机的旋转矫正变换矩阵与在新坐标系下的投影矩阵以及深度差异矩阵
8. 使用时，通过立体矫正获取两个相机的矫正映射来矫正图像
9.  使用`cv::StereoBM`计算视差图
10. 视差图可以转深度图和点云

- 视差图可以看作立体匹配（提取特征、特征匹配）的输出承载体
- 视差图还需要进行空洞填补
- 深度图是立体匹配与点云生成之间的中间桥梁

视差图通过双目相机的几何模型变换到相机的3D空间中，进而转深度图与点云
